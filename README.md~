# Performance profiling tool
## Goal
In this projet, we are going to use cAdvisor to monitor Docker containers. Furthermore, we will push the data into InfluxDB and finally display it through Grafana.

- cAdvisor: Google Monitoring Container: provides container users an understanding of the resource usage and performance characteristics of their running containers.
    
- InfluxDB: Time series database. It's useful for recording metrics, events, and performing analytics.

- Grafana: Realtime designing tool: we will use it to visualize the recorded data. Grafana is easily configurable and will let you choose what to render
    
In order to monitor docker containers, we are going to wrap mmpeg c++ library into a container and then, stress that library to increase the load in term of memory and cpu usage.

This stress tool generates command lines that target FFMpeg Library. It uses the novelty search to generate efficiently test data passed as parameters to the command lines.

More details can be find [here]
[here]:https://github.com/mboussaa/script-generator-for-ffmpeg

We are going to compile ffmpeg library with at least, two different optimization options (e.g. -O1, 02...) each one will be wrapped in a docker container. Then, we will monitor both versions in term of non functional properties.

##Installation : 
###InfluxDB Installation :
Start InfluxDB inside a new container.

    docker run -d -p 8083:8083 -p 8086:8086 --expose 8090 --expose 8099 tutum/influxdb

Navigate now to InfluxDB administration page at

    http://10.0.2.15:8083. 

Login with root/root and create a new database called cadvisorDB.

###cAdvisor Installation :
Now start cAdvisor with the extra parameters storage_driver and storage_driver_host.

    docker run      
    --volume=/:/rootfs:ro      
    --volume=/var/run:/var/run:rw      
    --volume=/sys:/sys:ro      
    --volume=/var/lib/docker/:/var/lib/docker:ro      
    --publish=8080:8080      
    --detach=true      
    --name=cadvisorDB1      
    google/cadvisor:latest   
    --logtostderr    
    -storage_driver=influxdb     
    -storage_driver_host=10.0.2.15:8086 
    -storage_driver_db= 
    
You should specify your ip host for the storage_driver_host. As well, you have to put the name of the data base you have created "cadvisorDB".

If you wan to access to cAdvisor Web UI, please navigate to : 

    http://10.0.2.15:8080 (Assuming that 10.0.2.15 is your host ip)

###Grafana Installation :
Start another container running Grafana.

    docker run -d -p 80:80 -e HTTP_USER=root -e HTTP_PASS=root -e INFLUXDB_HOST=10.0.2.15 -e INFLUXDB_PORT=8086 -e INFLUXDB_NAME=cadvisorDB -e INFLUXDB_USER=root -e INFLUXDB_PASS=root tutum/grafana
    
You can access to Grafana Web UI through : 
    
    http://10.0.2.15:80

So far, we have created 3 containers :
  - cAdvisor container
  - InfluxDB container
  - Grafana Container
  
Now, we have to create a stress container for ffmpeg in order to (1) gather data from cAdvisor, (2) save them in InfluxDB and (3) show statistical analyzes through Grafana.

To do so, we are going to create two other containers from ffmpeg with two different compilation optimizations. Then, we are going to launch many ffmpeg command lines on that containers in order to increase the load.

Go through O1 and O2 repositories and type the following commands in order to create docker images:

    In O1:
    docker build -t o1version .
    In O2:
    docker build -t o2version .

Now we have to start the two containers from both images.
